{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "ROLE": {
      "Type": "AWS::IAM::Role",
      "Properties": {
         "AssumeRolePolicyDocument": {
            "Version" : "2012-10-17",
            "Statement": [ {
               "Effect": "Allow",
               "Principal": {
                  "Service": [ "ec2.amazonaws.com" ]
               },
               "Action": [ "sts:AssumeRole" ]
            } ]
         },
         "Policies": [
            {
              "PolicyName": "S3_ReadOnly",
              "PolicyDocument": {
                  "Version" : "2012-10-17",
                  "Statement": [ {
                      "Effect": "Allow",
                      "Action": [
                        "s3:Get*",
                        "s3:List*"
                      ],
                      "Resource": "*"
                  } ]
                }
            },
            {
              "PolicyName": "ECR_FullAccess",
              "PolicyDocument": {
                  "Version" : "2012-10-17",
                  "Statement": [ {
                      "Effect": "Allow",
                      "Action": [
                        "ecr:GetAuthorizationToken",
                        "ecr:BatchCheckLayerAvailability",
                        "ecr:GetDownloadUrlForLayer",
                        "ecr:GetRepositoryPolicy",
                        "ecr:DescribeRepositories",
                        "ecr:ListImages",
                        "ecr:DescribeImages",
                        "ecr:BatchGetImage",
                        "ecr:InitiateLayerUpload",
                        "ecr:UploadLayerPart",
                        "ecr:CompleteLayerUpload",
                        "ecr:PutImage"
                      ],
                      "Resource": "*"
                  } ]
                }
            }
         ]
      }
   },
    "PROFILE": {
      "Type": "AWS::IAM::InstanceProfile",
      "Properties": {
         "Roles": [
            { "Ref": "ROLE" }
         ],
         "InstanceProfileName": "Docker_Access_Role"
      }
   },
    "EC2": {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1a",
         "IamInstanceProfile" : {
          "Ref": "PROFILE"
         },
         "InstanceType" : "t2.micro",
         "ImageId": "ami-203e045b",
         "KeyName" : "forestindex",
         "Monitoring" : true,
         "SecurityGroupIds" : [ "sg-1b90da6a" ],
         "SubnetId" : "subnet-866fe4dc",
         "Tags" : [
           {
             "Key": "Name",
             "Value": "Forest Index API Server"
           }
         ],
         "Tenancy" : "default"
      }
    },
    "EIP": {
      "Type" : "AWS::EC2::EIP",
      "Properties" : {
         "InstanceId" : {
           "Ref": "EC2"
         }
      }
    },
    "RECORDSET": {
      "Type" : "AWS::Route53::RecordSet",
      "Properties" : {
        "HostedZoneId" : "Z20UF4U5VJ7QAD",
        "Name" : "indexapi.forestindex.com",
        "ResourceRecords" : [
          {
            "Ref": "EIP"
          }
        ],
        "TTL" : "86400",
        "Type" : "A"
      }
    }
  }
}
